# 基本設定
http_port 3128

# アクセス制御
acl localnet src 172.16.0.0/12  # Docker内部ネットワーク
acl localnet src 127.0.0.1/32   # localhost
acl localnet src 192.168.0.0/16  # プライベートIP
acl localnet src 10.0.0.0/8      # プライベートIP

# 安全なポート
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl CONNECT method CONNECT

# アクセス許可
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localnet
http_access allow localhost
http_access deny all

# キャッシュ無効（検証用）
cache deny all

# ログ設定（デバッグ用に詳細ログ）
access_log /var/log/squid/access.log
cache_log /var/log/squid/cache.log